<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1047px" preserveAspectRatio="none" style="width:918px;height:1047px;background:#FFFFFF;" version="1.1" viewBox="0 0 918 1047" width="918px" zoomAndPan="magnify"><defs><filter height="300%" id="fqb45512o16fd" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="302" x="305.5" y="28.708">Two-way encryption using ECIES</text><rect fill="#FFFFFF" filter="url(#fqb45512o16fd)" height="251.0625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="192" y="154.3828"/><rect fill="#FFFFFF" filter="url(#fqb45512o16fd)" height="171.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="192" y="488.8438"/><rect fill="#FFFFFF" filter="url(#fqb45512o16fd)" height="255.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="192" y="689.6406"/><rect fill="#FFFFFF" filter="url(#fqb45512o16fd)" height="83.832" style="stroke:#A80036;stroke-width:1.0;" width="10" x="635" y="196.082"/><rect fill="#FFFFFF" filter="url(#fqb45512o16fd)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="635" y="517.9766"/><rect fill="#FFFFFF" filter="url(#fqb45512o16fd)" height="113.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="635" y="760.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="54" x2="54" y1="123.25" y2="963.5703"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="196.5" x2="196.5" y1="123.25" y2="963.5703"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="640" x2="640" y1="123.25" y2="963.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="36" y="119.9482">user</text><ellipse cx="54" cy="49.9531" fill="#FEFECE" filter="url(#fqb45512o16fd)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M54,57.9531 L54,84.9531 M41,65.9531 L67,65.9531 M54,84.9531 L41,99.9531 M54,84.9531 L67,99.9531 " fill="none" filter="url(#fqb45512o16fd)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="36" y="975.5654">user</text><ellipse cx="54" cy="988.8672" fill="#FEFECE" filter="url(#fqb45512o16fd)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M54,996.8672 L54,1023.8672 M41,1004.8672 L67,1004.8672 M54,1023.8672 L41,1038.8672 M54,1023.8672 L67,1038.8672 " fill="none" filter="url(#fqb45512o16fd)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#fqb45512o16fd)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="27" x="181.5" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="13" x="188.5" y="107.9482">UI</text><rect fill="#FEFECE" filter="url(#fqb45512o16fd)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="27" x="181.5" y="962.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="13" x="188.5" y="982.5654">UI</text><rect fill="#FEFECE" filter="url(#fqb45512o16fd)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="76" x="600" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="607" y="107.9482">Backend</text><rect fill="#FEFECE" filter="url(#fqb45512o16fd)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="76" x="600" y="962.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="607" y="982.5654">Backend</text><rect fill="#FFFFFF" filter="url(#fqb45512o16fd)" height="251.0625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="192" y="154.3828"/><rect fill="#FFFFFF" filter="url(#fqb45512o16fd)" height="171.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="192" y="488.8438"/><rect fill="#FFFFFF" filter="url(#fqb45512o16fd)" height="255.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="192" y="689.6406"/><rect fill="#FFFFFF" filter="url(#fqb45512o16fd)" height="83.832" style="stroke:#A80036;stroke-width:1.0;" width="10" x="635" y="196.082"/><rect fill="#FFFFFF" filter="url(#fqb45512o16fd)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="635" y="517.9766"/><rect fill="#FFFFFF" filter="url(#fqb45512o16fd)" height="113.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="635" y="760.9063"/><polygon fill="#A80036" points="180,150.3828,190,154.3828,180,158.3828,184,154.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="54" x2="186" y1="154.3828" y2="154.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="61" y="149.3169">Load Page</text><polygon fill="#A80036" points="623,192.082,633,196.082,623,200.082,627,196.082" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="202" x2="629" y1="196.082" y2="196.082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="303" x="209" y="191.0161">GET /pubkey (SERVER_PKEY: server public key)</text><path d="M650,167.3828 L650,207.3828 L909,207.3828 L909,177.3828 L899,167.3828 L650,167.3828 " fill="#FBFB77" filter="url(#fqb45512o16fd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M899,167.3828 L899,177.3828 L909,177.3828 L899,167.3828 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="656" y="184.4497">SERVER_PKEY = Backend Public key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238" x="656" y="199.5825">SERVER_SKEY = Backend Private key</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="645" x2="687" y1="237.7813" y2="237.7813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="687" x2="687" y1="237.7813" y2="250.7813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="646" x2="687" y1="250.7813" y2="250.7813"/><polygon fill="#A80036" points="656,246.7813,646,250.7813,656,254.7813,652,250.7813" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="652" y="232.7153">Get SERVER_PKEY from storage</text><polygon fill="#A80036" points="213,275.9141,203,279.9141,213,283.9141,209,279.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="207" x2="639" y1="279.9141" y2="279.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="409" x="219" y="274.8481">SERVER_PKEY(in compressed base64 format(35 base64 chars))</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="202" x2="244" y1="309.0469" y2="309.0469"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="244" x2="244" y1="309.0469" y2="322.0469"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="203" x2="244" y1="322.0469" y2="322.0469"/><polygon fill="#A80036" points="213,318.0469,203,322.0469,213,326.0469,209,322.0469" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="209" y="303.981">Persist SERVER_PKEY in localStorage</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="202" x2="244" y1="357.2461" y2="357.2461"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="244" x2="244" y1="357.2461" y2="370.2461"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="203" x2="244" y1="370.2461" y2="370.2461"/><polygon fill="#A80036" points="213,366.2461,203,370.2461,213,374.2461,209,370.2461" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="359" x="209" y="352.1802">Generate key pair UI_SKEY, UI_PKEY (stored in-memory)</text><path d="M5,335.0469 L5,375.0469 L183,375.0469 L183,345.0469 L173,335.0469 L5,335.0469 " fill="#FBFB77" filter="url(#fqb45512o16fd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M173,335.0469 L173,345.0469 L183,345.0469 L173,335.0469 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="11" y="352.1138">UI_PKEY = UI Public key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="11" y="367.2466">UI_SKEY = UI Private key</text><polygon fill="#A80036" points="65,401.4453,55,405.4453,65,409.4453,61,405.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59" x2="196" y1="405.4453" y2="405.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="71" y="400.3794">WebPage content</text><path d="M171,418.4453 L171,458.4453 L664,458.4453 L664,428.4453 L654,418.4453 L171,418.4453 " fill="#FBFB77" filter="url(#fqb45512o16fd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M654,418.4453 L654,428.4453 L664,428.4453 L654,418.4453 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="361" x="230.75" y="435.5122">Only SERVER_PKEY, UI_PKEY are shared across network.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="329" x="230.75" y="450.645">SERVER_SKEY, UI_SKEY always remains with owner</text><polygon fill="#A80036" points="180,484.8438,190,488.8438,180,492.8438,184,488.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="54" x2="186" y1="488.8438" y2="488.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="61" y="483.7778">GET /hello</text><polygon fill="#A80036" points="623,513.9766,633,517.9766,623,521.9766,627,517.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="202" x2="629" y1="517.9766" y2="517.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281" x="209" y="512.9106">GET /hello (headers {x-pub-key : UI_PKEY})</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="645" x2="687" y1="547.1094" y2="547.1094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="687" x2="687" y1="547.1094" y2="560.1094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="646" x2="687" y1="560.1094" y2="560.1094"/><polygon fill="#A80036" points="656,556.1094,646,560.1094,656,564.1094,652,560.1094" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="652" y="542.0435">Encrypt response with UI_PKEY</text><polygon fill="#A80036" points="213,585.2422,203,589.2422,213,593.2422,209,589.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="207" x2="639" y1="589.2422" y2="589.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="219" y="584.1763">Encrypted payload</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="202" x2="244" y1="618.375" y2="618.375"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="244" x2="244" y1="618.375" y2="631.375"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="203" x2="244" y1="631.375" y2="631.375"/><polygon fill="#A80036" points="213,627.375,203,631.375,213,635.375,209,631.375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="209" y="613.3091">Decrypt payload with UI_SKEY</text><polygon fill="#A80036" points="65,656.5078,55,660.5078,65,664.5078,61,660.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59" x2="196" y1="660.5078" y2="660.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="71" y="655.4419">Response</text><polygon fill="#A80036" points="180,685.6406,190,689.6406,180,693.6406,184,689.6406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="54" x2="186" y1="689.6406" y2="689.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="61" y="684.5747">POST /data</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="202" x2="244" y1="718.7734" y2="718.7734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="244" x2="244" y1="718.7734" y2="731.7734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="203" x2="244" y1="731.7734" y2="731.7734"/><polygon fill="#A80036" points="213,727.7734,203,731.7734,213,735.7734,209,731.7734" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265" x="209" y="713.7075">encrypt payload body with SERVER_PKEY</text><polygon fill="#A80036" points="623,756.9063,633,760.9063,623,764.9063,627,760.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="202" x2="629" y1="760.9063" y2="760.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="402" x="209" y="755.8403">POST /data (headers {x-pub-key : UI_PKEY}, body: encrypted)</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="645" x2="687" y1="790.0391" y2="790.0391"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="687" x2="687" y1="790.0391" y2="803.0391"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="646" x2="687" y1="803.0391" y2="803.0391"/><polygon fill="#A80036" points="656,799.0391,646,803.0391,656,807.0391,652,803.0391" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="652" y="784.9731">decrypt payload with SERVER_SKEY</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="645" x2="687" y1="832.1719" y2="832.1719"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="687" x2="687" y1="832.1719" y2="845.1719"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="646" x2="687" y1="845.1719" y2="845.1719"/><polygon fill="#A80036" points="656,841.1719,646,845.1719,656,849.1719,652,845.1719" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="652" y="827.106">encrypt response with UI_PKEY</text><polygon fill="#A80036" points="213,870.3047,203,874.3047,213,878.3047,209,874.3047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="207" x2="639" y1="874.3047" y2="874.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="219" y="869.2388">Encrypted payload</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="202" x2="244" y1="903.4375" y2="903.4375"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="244" x2="244" y1="903.4375" y2="916.4375"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="203" x2="244" y1="916.4375" y2="916.4375"/><polygon fill="#A80036" points="213,912.4375,203,916.4375,213,920.4375,209,916.4375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="209" y="898.3716">Decrypt payload with UI_SKEY</text><polygon fill="#A80036" points="65,941.5703,55,945.5703,65,949.5703,61,945.5703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59" x2="196" y1="945.5703" y2="945.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="71" y="940.5044">Response</text><!--MD5=[9adc2834288b82272d30f39838fbc0d8]
@startuml
title Two-way encryption using ECIES
actor user
participant UI
participant Backend

user -> UI: Load Page
activate UI
UI -> Backend: GET /pubkey (SERVER_PKEY: server public key)
activate Backend
note right: SERVER_PKEY = Backend Public key\nSERVER_SKEY = Backend Private key
Backend - -> Backend: Get SERVER_PKEY from storage
Backend -> UI: SERVER_PKEY(in compressed base64 format(35 base64 chars))
deactivate Backend
UI - -> UI: Persist SERVER_PKEY in localStorage
UI - -> UI: Generate key pair UI_SKEY, UI_PKEY (stored in-memory)
note left: UI_PKEY = UI Public key\nUI_SKEY = UI Private key
UI -> user: WebPage content
deactivate UI

note over UI, Backend: Only SERVER_PKEY, UI_PKEY are shared across network.\nSERVER_SKEY, UI_SKEY always remains with owner

user -> UI: GET /hello
activate UI
UI -> Backend: GET /hello (headers {x-pub-key : UI_PKEY})
activate Backend
Backend - -> Backend: Encrypt response with UI_PKEY
Backend -> UI: Encrypted payload
deactivate Backend
UI - -> UI: Decrypt payload with UI_SKEY
UI -> user: Response
deactivate UI

user -> UI: POST /data
activate UI
UI - -> UI: encrypt payload body with SERVER_PKEY
UI -> Backend: POST /data (headers {x-pub-key : UI_PKEY}, body: encrypted)
activate Backend
Backend - -> Backend: decrypt payload with SERVER_SKEY
Backend - -> Backend: encrypt response with UI_PKEY
Backend -> UI: Encrypted payload
deactivate Backend
UI - -> UI: Decrypt payload with UI_SKEY
UI -> user: Response
deactivate UI
@enduml

PlantUML version 1.2022.1(Tue Feb 01 18:19:58 UTC 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>